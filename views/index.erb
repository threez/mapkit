<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<title>VARTA Guide 2.1</title>
		<style type="text/css" media="screen"><!--
		  body { background: url(images/gradient.jpg) repeat-x; }
			#box { width: 800px; margin: 18px auto 0; }
			#title { width: 800px; margin: 0px; padding: 30px 0px 30px 0px; }
			#map { width: 650px; height: 500px; border: solid 1px #999; }
			#list { float: right; width: 130px; margin: 0px; padding: 0px; border: solid 1px #999; list-style: none;}
			#list li { margin: 0px; padding: 0px; }
			#list li a { padding: 10px; background: url(images/gradient.jpg) center repeat-x; height: 50px; width: 110px; display: block; }
			p { color: #666; font-size: 16px; font-family: "Lucida Grande", Arial, sans-serif; font-weight: normal; margin-top: 0; }
			h1 { color: #778fbd; font-size: 20px; font-family: "Lucida Grande", Arial, sans-serif; font-weight: 500; line-height: 32px; margin-top: 4px; }
			h2 { color: #778fbd; font-size: 18px; font-family: "Lucida Grande", Arial, sans-serif; font-weight: normal; margin: 0.83em 0 0; }
			h3 { color: #666; font-size: 60px; font-family: "Lucida Grande", Arial, sans-serif; font-weight: bold; text-align: center; letter-spacing: -1px; width: auto; }
			h4 { font-weight: bold; text-align: center; margin: 1.33em 0; }
			a { color: #666; text-decoration: underline; }
		--></style>
		
		<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAnfs7bKE82qgb3Zc2YyS-oBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxSySz_REpPq-4WZA27OwgbtyR3VcA&sensor=false&hl=de"
            type="text/javascript"></script>
    <script src="jquery.js" type="text/javascript"></script>
    <script type="text/javascript">
      var map = null, 
          inovex_hq = null,
          inovex_hq_marker = null,
          points_of_interest = new Array(),
          last_cursor = null,
          $map_divs = null;
      var inovex_text = "<img src='http://www.inovex.de/images/inovex_logo.gif'><br/><b>Here is the inovex <u>HQ</u></b><br/><br/><a href='http://inovex.de'>inovex</a>";
      var aral = new GLatLng(48.901,8.666);
      var aral_marker = new GMarker(aral);
      var aral_text = "<b>Aral!</b>";
      var ggeo = new GClientGeocoder();
    
      function displayAndCenter(map, position, text) {
        map.panTo(position);
        map.openInfoWindowHtml(position, text);
        return false;
      }
      
      function start() {
        ggeo.getLatLng("Karlsruherstr. 71, Pforzheim", function(point) {
          inovex_hq = point;
          inovex_hq_marker = new GMarker(inovex_hq);
          
          initialize();
        });
      }
      
      function updatePointsOfInterest() {
        points_of_interest = new Array();
        $map_divs = $("#map div");
        var bounds = map.getBounds(),
            sw = bounds.getSouthWest(),
            ne = bounds.getNorthEast(),
            path = "/" + ne.lat() + "/" + sw.lng() + "/" + sw.lat() +
                  "/" + ne.lng() + "/" + map.getZoom() + ".json";
        $.getJSON(path, function(data) {
          var results = data['results'];
          for(var i = 0; i < results.length; i++) {
            var bound = new GLatLngBounds(
              new GLatLng(results[i][2], results[i][1]),
              new GLatLng(results[i][0], results[i][3])
            );
            bound.title = results[i][4];
            bound.address = results[i][5];
            bound.city = results[i][6];
            bound.poi_point = new GLatLng(results[i][7], results[i][8]);
            
            points_of_interest.push(bound);
          }
        });
      }
      
      function initialize() {
        if (GBrowserIsCompatible()) {
          map = new GMap2(document.getElementById("map"));
          
          // new layer
          var layer = new GTileLayer(null, 0, 21, {
            isPng: true,
            opacity: 1
          });
          layer.getTileUrl = function(tile, zoom) {
            return "" + zoom + "/" + tile.x + "/" + tile.y + ".png";
          }
          
          map.setCenter(inovex_hq, 14);
        
          map.addOverlay(inovex_hq_marker);
          map.addOverlay(aral_marker);
          map.addControl(new GLargeMapControl());
          map.addControl(new GMapTypeControl());
          //map.enableScrollWheelZoom();
        
          GEvent.addListener(inovex_hq_marker, "click", function() {
            displayAndCenter(map, inovex_hq, inovex_text);
          });
        
          GEvent.addListener(aral_marker, "click", function() {
            displayAndCenter(map, aral, aral_text);
          });
          
          GEvent.addListener(map, "click",
            function(overlay, latlng, overlaylatlng) {
              
            for (var i = 0; i < points_of_interest.length; i++) {
              if (points_of_interest[i].contains(latlng)) {
                map.openInfoWindowHtml(points_of_interest[i].poi_point,
                  points_of_interest[i].title + "<br>" +
                  points_of_interest[i].address + "<br>" +
                  points_of_interest[i].city);
                break;
              }
            }
          });
          
          GEvent.addListener(map, "mousemove", function(latlng) {
            var found_one = false;
            for (var i = 0; i < points_of_interest.length; i++) {
              if (points_of_interest[i].contains(latlng)) {
                found_one = true;
                last_cursor = $map_divs.css("cursor");
                $map_divs.css("cursor", "pointer");
                break;
              }
            }
            if (!found_one) $map_divs.css("cursor", "move");
            
            //$("#position").html(latlng.lat() + ", " + latlng.lng() + " - " + found_one);
          });
          
          GEvent.addListener(map, "moveend", updatePointsOfInterest);
          
          map.addOverlay(new GTileLayerOverlay(layer));
          updatePointsOfInterest();
        }
      }
    </script>
	</head>

  <body onload="start()" onunload="GUnload()">
		<div id="box">
			<h3 id="title">VARTA Guide 2.1</h3>
			<h2 id="position"></h2>
			
    	<ul id="list">
        <li><a href="#" onClick="displayAndCenter(map, inovex_hq, inovex_text);">inovex HQ</a></li>
        <li><a href="#" onClick="displayAndCenter(map, aral, aral_text);">Aral</a></li>
    	</ul>
    	<div id="map"></div>
		</div>
		
	</body>

</html>